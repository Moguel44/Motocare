<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MotoCare</title>

<style>
:root{
  --bg:#0b1220;
  --card:#020617;
  --accent:#7dd3fc;
  --border:#1e293b;
}
body{
  margin:0;
  padding:16px;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
  background:var(--bg);
  color:#e5e7eb;
}
.header{text-align:center;margin-bottom:20px}
.logo-big{width:110px;height:110px;border-radius:22px}
h1{color:var(--accent);margin:10px 0}
.card{
  max-width:720px;
  margin:0 auto 20px;
  padding:20px;
  background:rgba(2,6,23,.95);
  border-radius:18px;
}
.hidden{display:none}
input,textarea,select{
  width:100%;
  margin-top:12px;
  padding:14px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  color:#e5e7eb;
}
.actions{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin-top:18px;
}
button.primary{
  padding:14px;
  border-radius:22px;
  border:2px solid transparent;
  background:
    linear-gradient(#020617,#020617) padding-box,
    linear-gradient(135deg,#c9a227,#7c3aed) border-box;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
button.danger{
  background:#991b1b;
  color:#fff;
  border:none;
  padding:6px 10px;
  border-radius:12px;
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:flex;
  align-items:center;
  justify-content:center;
}
.modal.hidden{display:none}
.modal-card{
  background:#020617;
  padding:20px;
  border-radius:18px;
  max-width:360px;
  width:90%;
}
.modal-actions{
  display:flex;
  gap:12px;
  margin-top:16px;
}
.modal-actions .confirm{
  background:#991b1b;
  color:#fff;
  border:none;
}
</style>
</head>

<body>

<div class="header">
  <h1>MotoCare</h1>
</div>

<div id="home" class="card">
  <h2>Motos registradas</h2>
  <ul id="listaMotos"></ul>
  <div class="actions">
    <button class="primary" id="btnMoto">‚ûï Moto</button>
    <button class="primary" id="btnMantenimiento">üõ†Ô∏è Mantenimiento</button>
  </div>
  <button class="primary" id="btnHistorial">üìú Historial</button>
</div>

<div id="moto" class="card hidden">
  <input id="marca" placeholder="Marca">
  <input id="modelo" placeholder="Modelo">
  <input id="anio" placeholder="A√±o">
  <input id="cilindrada" placeholder="Cilindrada">
  <input id="neumaticos" placeholder="Neum√°ticos">
  <input id="itv" type="date">
  <div class="actions">
    <button class="primary" id="guardarMoto">Guardar</button>
    <button class="primary" id="volverMoto">Volver</button>
  </div>
</div>

<div id="mantenimiento" class="card hidden">
  <select id="motoSeleccionada"></select>
  <input id="km" placeholder="Kil√≥metros">
  <input id="fecha" type="date">
  <label><input type="checkbox" value="Aceite"> Aceite</label>
  <label><input type="checkbox" value="Filtro"> Filtro</label>
  <div class="actions">
    <button class="primary" id="guardarRevision">Guardar</button>
    <button class="primary" id="volverMantenimiento">Volver</button>
  </div>
</div>

<div id="historial" class="card hidden">
  <select id="historialMoto"></select>
  <ul id="listaHistorial"></ul>
  <button class="primary" id="volverHistorial">Volver</button>
</div>

<!-- MODALES -->
<div id="editModal" class="modal hidden">
  <div class="modal-card">
    <input type="date" id="editFecha">
    <input id="editKm">
    <textarea id="editTrabajos"></textarea>
    <div class="modal-actions">
      <button id="cancelEdit">Cancelar</button>
      <button class="confirm" id="saveEdit">Guardar</button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded',()=>{
const $=id=>document.getElementById(id);
const getMotos=()=>JSON.parse(localStorage.getItem('motos')||'[]');
const setMotos=m=>localStorage.setItem('motos',JSON.stringify(m));

let editMotoId=null, editRevisionIndex=null;

function show(id){
 ['home','moto','mantenimiento','historial'].forEach(s=>$(s).classList.add('hidden'));
 $(id).classList.remove('hidden');
 if(id==='historial') cargarHistorialSelector();
}

function cargar(){
 listaMotos.innerHTML='';
 motoSeleccionada.innerHTML='<option value="">Moto</option>';
 getMotos().forEach(m=>{
  const li=document.createElement('li');
  li.textContent=m.datos.marca;
  listaMotos.appendChild(li);
  const o=document.createElement('option');
  o.value=m.id; o.textContent=m.datos.marca;
  motoSeleccionada.appendChild(o);
 });
}

function cargarHistorialSelector(){
 historialMoto.innerHTML='<option value="">Moto</option>';
 getMotos().forEach(m=>{
  const o=document.createElement('option');
  o.value=m.id; o.textContent=m.datos.marca;
  historialMoto.appendChild(o);
 });
 listaHistorial.innerHTML='';
}

historialMoto.onchange=()=>{
 listaHistorial.innerHTML='';
 const motoId=historialMoto.value;
 const m=getMotos().find(x=>x.id===motoId);
 if(!m) return;
 m.historial.forEach((r,i)=>{
  const li=document.createElement('li');
  li.innerHTML=`${r.fecha} ‚Äì ${r.km} km
    <br><button class="primary">‚úèÔ∏è Editar</button>`;
  li.querySelector('button').onclick=()=>abrirEditor(motoId,i);
  listaHistorial.appendChild(li);
 });
};

function abrirEditor(motoId,i){
 const m=getMotos().find(x=>x.id===motoId);
 const r=m.historial[i];
 editMotoId=motoId;
 editRevisionIndex=i;
 editFecha.value=r.fecha;
 editKm.value=r.km;
 editTrabajos.value=r.trabajos.join(', ');
 editModal.classList.remove('hidden');
}

saveEdit.onclick=()=>{
 const motos=getMotos();
 const m=motos.find(x=>x.id===editMotoId);
 m.historial[editRevisionIndex]={
  fecha:editFecha.value,
  km:editKm.value,
  trabajos:editTrabajos.value.split(',').map(t=>t.trim())
 };
 setMotos(motos);
 editModal.classList.add('hidden');
 historialMoto.onchange();
};

cancelEdit.onclick=()=>editModal.classList.add('hidden');

btnMoto.onclick=()=>show('moto');
btnMantenimiento.onclick=()=>show('mantenimiento');
btnHistorial.onclick=()=>show('historial');
volverMoto.onclick=
volverMantenimiento.onclick=
volverHistorial.onclick=()=>show('home');

guardarMoto.onclick=()=>{
 const motos=getMotos();
 motos.push({id:'m'+Date.now(),datos:{marca:marca.value},historial:[]});
 setMotos(motos); cargar(); show('home');
};

guardarRevision.onclick=()=>{
 const motos=getMotos();
 const m=motos.find(x=>x.id===motoSeleccionada.value);
 const trabajos=[...document.querySelectorAll('#mantenimiento input[type=checkbox]:checked')].map(c=>c.value);
 m.historial.push({fecha:fecha.value,km:km.value,trabajos});
 setMotos(motos); show('home');
};

cargar();
});
</script>
</body>
</html>
