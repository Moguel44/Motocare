<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#22d3ee">
<title>MotoCare</title>
<link rel="manifest" href="manifest.json">
<style>
/* (ESTILOS SIN CAMBIOS) */
:root{
  --bg:#0b1220;
  --card:#020617;
  --accent:#7dd3fc;
  --border:#1e293b;
}
body{margin:0;padding:16px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;background:var(--bg);color:#e5e7eb;}
.header{text-align:center;margin-bottom:20px;}
.logo-big{width:110px;height:110px;border-radius:22px;}
h1{color:var(--accent);margin:10px 0 0;}
.card{max-width:720px;margin:0 auto 20px;padding:20px;background:rgba(2,6,23,.95);border-radius:18px;}
.hidden{display:none}
input,textarea,select{width:100%;margin-top:12px;padding:14px;background:var(--card);border:1px solid var(--border);border-radius:12px;color:#e5e7eb;}
.actions{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:18px;}
button.primary{padding:14px;border-radius:22px;border:2px solid transparent;background:linear-gradient(#020617,#020617) padding-box,linear-gradient(135deg,#c9a227,#7c3aed) border-box;color:#fff;font-weight:600;}
button.danger{background:#991b1b;color:#fff;border:none;padding:8px 12px;border-radius:12px;}
.check-item{display:grid;grid-template-columns:26px 1fr;align-items:center;gap:12px;margin:10px 0;}
.check-item input{width:20px;height:20px;margin:0;}
.check-item span{text-align:left;line-height:1.4;}
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:#020617;border:1px solid var(--border);padding:14px 18px;border-radius:16px;opacity:0;transition:.3s;}
.toast.show{opacity:1}
.toast.error{border-color:#dc2626}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;}
.modal.hidden{display:none}
.modal-card{background:#020617;padding:20px;border-radius:18px;max-width:360px;width:90%;}
.modal-actions{display:flex;gap:12px;margin-top:16px;}
.modal-actions button{flex:1;padding:12px;border-radius:14px;}
.modal-actions .confirm{background:#991b1b;color:#fff;border:none;}
</style>
</head>

<body>

<!-- (HTML SIN CAMBIOS) -->

<script>
document.addEventListener('DOMContentLoaded',()=>{
  const $=id=>document.getElementById(id);
  const getMotos=()=>JSON.parse(localStorage.getItem('motos')||'[]');
  const setMotos=m=>localStorage.setItem('motos',JSON.stringify(m));

  function show(id){
    ['home','moto','mantenimiento','historial'].forEach(s=>$(s).classList.add('hidden'));
    $(id).classList.remove('hidden');
    if(id==='historial') cargarHistorial();
  }

  function toast(msg,err){
    const t=document.createElement('div');
    t.className='toast'+(err?' error':'');
    t.textContent=msg;
    document.body.appendChild(t);
    requestAnimationFrame(()=>t.classList.add('show'));
    setTimeout(()=>t.remove(),3000);
  }

  function cargar(){
    const ul=$('listaMotos'); ul.innerHTML='';
    const sel=$('motoSeleccionada'); sel.innerHTML='<option value="">Selecciona una moto</option>';
    getMotos().forEach(m=>{
      const li=document.createElement('li');
      li.style.display='flex';
      li.style.justifyContent='space-between';
      li.innerHTML=`${m.datos.marca} ${m.datos.modelo||''}`;
      const b=document.createElement('button');
      b.className='danger';
      b.textContent='ðŸ—‘ï¸';
      b.onclick=()=>eliminarMoto(m.id);
      li.appendChild(b);
      ul.appendChild(li);
      const o=document.createElement('option');
      o.value=m.id;
      o.textContent=li.textContent;
      sel.appendChild(o);
    });
  }

  function guardarMoto(){
    const campos=['marca','modelo','anio','cilindrada','neumaticos','itv'];
    if(campos.some(c=>!$(c).value)){toast('Rellena todos los campos',true);return;}
    const motos=getMotos();
    motos.push({id:'m'+Date.now(),datos:{
      marca:marca.value,modelo:modelo.value,anio:anio.value,
      cilindrada:cilindrada.value,neumaticos:neumaticos.value,itv:itv.value
    },historial:[]});
    setMotos(motos); campos.forEach(c=>$(c).value='');
    cargar(); show('home');
  }

  let borrar=null;
  function eliminarMoto(id){
    const m=getMotos().find(x=>x.id===id);
    borrar=id;
    confirmText.textContent=`Eliminar ${m.datos.marca} ${m.datos.modelo||''} y su historial?`;
    confirmModal.classList.remove('hidden');
  }
  confirmDelete.onclick=()=>{setMotos(getMotos().filter(m=>m.id!==borrar));confirmModal.classList.add('hidden');cargar();}
  cancelDelete.onclick=()=>confirmModal.classList.add('hidden');

  /* ðŸ”§ FUNCIÃ“N CORREGIDA â€” ÃšNICO CAMBIO */
  function guardarRevision(){
    const sel=$('motoSeleccionada');
    const kmEl=$('km');
    const fechaEl=$('fecha');
    const obsEl=$('obs');
    const pendEl=$('pendiente');

    if(!sel.value || !kmEl.value || !fechaEl.value){
      toast('Completa los campos',true);
      return;
    }

    const motos=getMotos();
    const m=motos.find(x=>x.id===sel.value);

    const trabajos=[...document.querySelectorAll('#mantenimiento input[type=checkbox]:checked')]
      .map(c=>c.value);

    m.historial.push({
      km:kmEl.value,
      fecha:fechaEl.value,
      obs:obsEl.value,
      pendiente:pendEl.value,
      trabajos
    });

    setMotos(motos);

    kmEl.value=fechaEl.value=obsEl.value=pendEl.value='';
    document.querySelectorAll('#mantenimiento input[type=checkbox]').forEach(c=>c.checked=false);

    toast('RevisiÃ³n guardada');
    show('home');
  }

  function cargarHistorial(){
    const ul=$('listaHistorial'); ul.innerHTML='';
    getMotos().forEach(m=>{
      m.historial.forEach(r=>{
        const li=document.createElement('li');
        li.innerHTML=`<strong>${m.datos.marca}</strong> â€“ ${r.fecha} (${r.km} km)<br>${r.trabajos.join(', ')}`;
        ul.appendChild(li);
      });
    });
  }

  btnMoto.onclick=()=>show('moto');
  btnMantenimiento.onclick=()=>show('mantenimiento');
  btnHistorial.onclick=()=>show('historial');
  volverMoto.onclick=volverMantenimiento.onclick=volverHistorial.onclick=()=>show('home');
  guardarMoto.onclick=guardarMoto;
  guardarRevision.onclick=guardarRevision;

  cargar();
});
</script>
</body>
</html>
